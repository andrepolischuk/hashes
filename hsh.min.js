// Hsh Â© 2013-2015 Andrey Polischuk github.com/andrepolischuk/hsh
!function(){"use strict";function e(e){if(e instanceof RegExp)return e;if("*"===e)return new RegExp("^.*$");var t="^";e=e.split("/").splice(1,e.length);for(var n=0;n<e.length;n++)t+="\\/"+e[n].replace(/(\(|\)|\[|\]|\\|\.|\^|\$|\||\?|\+)/g,"\\$1").replace(/([*])/g,".*").replace(/(:\w+)/g,"(.+)");return t+="$",new RegExp(t)}function t(e){if(e instanceof RegExp)return[];for(var t=e.match(/:(\w+)/g)||[],n=0;n<t.length;n++)t[n]=t[n].substr(1);return t}function n(e,t){if(t){var i=e.match(t.exp),a=n(e,s.routes[t.queue+1]);return!i&&a?function(){a()}:function(){t.fn(new r(e,t,i),a)}}}function i(n,i){this.queue=s.routes.length,this.path=n,this.exp=e(this.path),this.params=t(this.path),this.fn=i}function r(e,t,n){this.path=e,this.origin=t.path,this.exp=t.exp,this.params={};for(var i=0;i<n.length-1;i++)this.params[t.params[i]||i]=n[i+1]}function a(){s.current=h.hash.replace(new RegExp(["^#",s.prefix.replace(/(\(|\)|\[|\]|\\|\.|\^|\$|\||\?|\+)/g,"\\$1"),"(.+)$"].join("")),"$1"),s.show(s.current)}function o(e){e!==h.hash&&(a(),e=h.hash),setTimeout(function(){o(e)},500)}function s(e,t){return"function"==typeof e?s("*",e):void("function"==typeof t?s.routes.push(new i(e,t)):"string"==typeof e?s.redirect(e):s.start())}var h=window.location,u="onhashchange"in window&&!(/MSIE.\d+\./gi.test(navigator.userAgent)&&parseInt(navigator.userAgent.replace(/.*MSIE.(\d+)\..*/gi,"$1"))<8);s.prefix="",s.current=null,s.routes=[],s.show=function(e){var t=n(e,s.routes[0]);t&&t()},s.redirect=function(e){e&&(h.hash=s.prefix+e)},s.redirectExternal=function(e){e&&(h=e)},s.start=function(){h.hash.length<=s.prefix.length&&(h.hash=s.prefix+"/"),a(),u?"addEventListener"in window?window.addEventListener("hashchange",a,!1):window.attachEvent("onhashchange",a):o()},"function"==typeof define&&define.amd?define([],function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:this.hsh=s}.call(this);
